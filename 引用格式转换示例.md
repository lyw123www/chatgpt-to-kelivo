# 引用格式转换示例

## 问题

导出的 Markdown 中，引用 `> text` 与角色标记 `> 用户` / `> 助手` 冲突。

### 原始格式（有冲突）

```markdown
> 用户

请解释这段代码：
> 这是一段引用的代码说明
> 它有多行


> 助手

好的，让我解释一下：
> 这段代码的作用是...
> 它实现了...
```

**问题**：无法区分哪个 `>` 是角色标记，哪个 `>` 是引用内容。

## 解决方案

将消息内容中的 Markdown 引用 `> text` 转换为 **4 个空格缩进**。

### 新格式（无冲突）

```markdown
> 用户

请解释这段代码：
    这是一段引用的代码说明
    它有多行


> 助手

好的，让我解释一下：
    这段代码的作用是...
    它实现了...
```

**优势**：
- ✅ 角色标记清晰：`> 用户` / `> 助手`
- ✅ 引用内容清晰：缩进的文本
- ✅ 符合 Markdown 规范（缩进也可以表示引用或特殊内容）
- ✅ 保持可读性

## 实现逻辑

```javascript
// 处理消息内容中的引用，避免与角色标记冲突
let content = msg.content;

// 将 Markdown 引用 (> text) 转换为缩进格式
const lines = content.split('\n');
const processedLines = [];

for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    if (line.trim().startsWith('>')) {
        // 移除 > 符号，添加 4 个空格缩进
        const quotedText = line.replace(/^>\s*/, '');
        processedLines.push(`    ${quotedText}`);
    } else {
        processedLines.push(line);
    }
}

content = processedLines.join('\n');
```

## 完整示例

### 输入（ChatGPT 复制的内容）

```
用户问：什么是 Markdown？

助手回答：
Markdown 是一种轻量级标记语言。

> 注意：Markdown 支持多种格式
> 包括粗体、斜体、代码块等

常用语法：
- **粗体**
- *斜体*
- `代码`
```

### 输出（导出到 Kelivo）

```markdown
# 对话标题


> 用户

用户问：什么是 Markdown？


> 助手

助手回答：
Markdown 是一种轻量级标记语言。

    注意：Markdown 支持多种格式
    包括粗体、斜体、代码块等

常用语法：
- **粗体**
- *斜体*
- `代码`


```

## 其他可选方案

如果你不喜欢缩进格式，还可以使用：

### 方案 1：使用 `**引用：**` 前缀

```markdown
> 助手

**引用：** 这是引用的内容
**引用：** 第二行引用
```

### 方案 2：使用 `「」` 引号

```markdown
> 助手

「这是引用的内容」
「第二行引用」
```

### 方案 3：使用 `|` 符号

```markdown
> 助手

| 这是引用的内容
| 第二行引用
```

### 方案 4：使用 HTML 标签

```markdown
> 助手

<blockquote>
这是引用的内容
第二行引用
</blockquote>
```

## 当前选择

**当前使用：4 个空格缩进**

原因：
- ✅ 简单、清晰
- ✅ 符合 Markdown 规范
- ✅ 不引入额外的符号
- ✅ 保持原有的层次结构

如果你想使用其他方案，请告诉我！

